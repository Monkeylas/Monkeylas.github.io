<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sichere Verschlüsselung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center">
    <header class="w-full bg-blue-600 text-center py-4 text-2xl font-semibold">
        Sichere Textverschlüsselung
    </header>
    
    <main class="bg-gray-800 p-6 rounded-lg shadow-lg mt-6 w-96 text-center">
        <h2 class="text-xl font-semibold mb-4"></h2>
        <textarea id="inputText" placeholder="Gib hier deinen Text ein..." 
                  class="w-full p-2 border border-gray-600 rounded mb-4 bg-gray-700 text-white"></textarea>
        
        <select id="mode" class="w-full p-2 border border-gray-600 rounded mb-4 bg-gray-700 text-white">
            <option value="encrypt">Verschlüsseln</option>
            <option value="decrypt">Entschlüsseln</option>
        </select>
        
        <button onclick="processText()" 
                class="w-full p-2 bg-blue-500 text-white rounded hover:bg-blue-600">Start</button>
        
        <div class="w-full bg-gray-600 rounded h-4 mt-4">
            <div id="progress" class="bg-green-500 h-4 rounded w-0"></div>
        </div>
        
        <p id="outputText" class="text-green-400 mt-4 font-mono break-words"></p>
    </main>
    
    <script>
        function generateKey() {
            return CryptoJS.lib.WordArray.random(32).toString(CryptoJS.enc.Hex);
        }

        const key = generateKey();
        const iv = CryptoJS.lib.WordArray.random(16);

        function encryptText(text) {
            let encrypted = CryptoJS.AES.encrypt(text, CryptoJS.enc.Hex.parse(key), {
                iv: iv,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.Pkcs7
            });
            return iv.toString(CryptoJS.enc.Hex) + ':' + encrypted.toString();
        }

        function decryptText(ciphertext) {
            let parts = ciphertext.split(':');
            let iv = CryptoJS.enc.Hex.parse(parts[0]);
            let encryptedText = parts[1];

            let decrypted = CryptoJS.AES.decrypt(encryptedText, CryptoJS.enc.Hex.parse(key), {
                iv: iv,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.Pkcs7
            });
            return decrypted.toString(CryptoJS.enc.Utf8);
        }

        function processText() {
            let inputText = document.getElementById("inputText").value;
            let mode = document.getElementById("mode").value;
            let outputText = document.getElementById("outputText");
            let progress = document.getElementById("progress");
            let step = 0;
            
            if (inputText.trim() === "") {
                outputText.textContent = "Bitte einen Text eingeben!";
                return;
            }
            
            progress.style.width = "0%";
            let interval = setInterval(() => {
                step += 10;
                progress.style.width = step + "%";
                
                if (step >= 100) {
                    clearInterval(interval);
                    let result = mode === "encrypt" ? encryptText(inputText) : decryptText(inputText);
                    outputText.textContent = result || "Fehler bei der Entschlüsselung!";
                }
            }, 200);
        }
    </script>
</body>
</html>
